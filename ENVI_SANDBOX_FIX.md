# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ENVI —Ñ–∞–π–ª—ã —Ç—Ä–µ–±—É—é—Ç –¥–≤–æ–π–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ ENVI —Ñ–∞–π–ª–æ–≤ –∏–∑ Finder:
1. –û—Ç–∫—Ä—ã–≤–∞–µ–º `.hdr` ‚Üí –æ—à–∏–±–∫–∞ "–ù–µ –Ω–∞–π–¥–µ–Ω .dat —Ñ–∞–π–ª"
2. –û—Ç–∫—Ä—ã–≤–∞–µ–º `.dat` ‚Üí –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

**–ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ?**

–§–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ **–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**, –Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∏—Ö "–Ω–µ –≤–∏–¥–∏—Ç" –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø.

## üîç –ü—Ä–∏—á–∏–Ω–∞: macOS App Sandboxing

macOS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **sandboxing** –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–∏—Å—Ç–µ–º—ã. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª:
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø **—Ç–æ–ª—å–∫–æ –∫ —ç—Ç–æ–º—É —Ñ–∞–π–ª—É**
- ‚ùå –î–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º —Ñ–∞–π–ª–∞–º –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ **–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω**

### –ü—Ä–∏–º–µ—Ä:

```swift
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª pre_katrina05.hdr
let hdrURL = URL(fileURLWithPath: "/path/to/pre_katrina05.hdr")

// –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
let datURL = hdrURL.deletingPathExtension().appendingPathExtension("dat")

// ‚ùå –û–®–ò–ë–ö–ê: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ pre_katrina05.dat!
FileManager.default.isReadableFile(atPath: datURL.path) // ‚Üí false
```

**–î–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**, sandbox –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É!

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ NSOpenPanel

–ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ –ø–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –æ–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ENVI —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ üìÅ /Users/mac/test_data/                    ‚îÇ
‚îÇ    üìÑ pre_katrina05.dat                     ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ           [–û—Ç–º–µ–Ω–∞]  [–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø]     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç **security-scoped bookmark** –¥–ª—è —Ñ–∞–π–ª–∞
- ‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ **–ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å** (–ø–æ–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è)

## üìù –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```swift
static func load(from url: URL) -> Result<HyperCube, ImageLoadError> {
    let fileExt = url.pathExtension.lowercased()
    let basePath = url.deletingPathExtension()
    
    let hdrURL: URL
    let datURL: URL
    
    if fileExt == "hdr" {
        hdrURL = url
        datURL = basePath.appendingPathExtension("dat")
    } else {
        datURL = url
        hdrURL = basePath.appendingPathExtension("hdr")
    }
    
    // ‚ùå –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ - –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç sandbox
    guard FileManager.default.fileExists(atPath: hdrURL.path) else {
        return .failure(.readError("–ù–µ –Ω–∞–π–¥–µ–Ω .hdr —Ñ–∞–π–ª"))
    }
    
    guard FileManager.default.fileExists(atPath: datURL.path) else {
        return .failure(.readError("–ù–µ –Ω–∞–π–¥–µ–Ω –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª"))
    }
    
    // ... –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `fileExists` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –Ω–æ `Data(contentsOf:)` –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –¥–æ—Å—Ç—É–ø–∞!

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```swift
private static func requestAccessToFile(_ fileURL: URL, description: String) -> URL? {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ
    guard !FileManager.default.isReadableFile(atPath: fileURL.path) else {
        return fileURL
    }
    
    // –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    DispatchQueue.main.sync {
        let panel = NSOpenPanel()
        panel.message = "ENVI —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É"
        panel.prompt = "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø"
        panel.directoryURL = fileURL.deletingLastPathComponent()
        panel.nameFieldStringValue = fileURL.lastPathComponent()
        
        if panel.runModal() == .OK, let selectedURL = panel.url {
            return selectedURL
        }
        return nil
    }
}

static func load(from url: URL) -> Result<HyperCube, ImageLoadError> {
    let fileExt = url.pathExtension.lowercased()
    let basePath = url.deletingPathExtension()
    
    var hdrURL: URL
    var datURL: URL
    
    if fileExt == "hdr" {
        hdrURL = url
        let possibleDataURL = findDataFile(basePath: basePath) ?? basePath.appendingPathExtension("dat")
        
        // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        if !FileManager.default.isReadableFile(atPath: possibleDataURL.path) {
            guard let accessibleURL = requestAccessToFile(possibleDataURL, description: "–±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö") else {
                return .failure(.readError("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–Ω–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É"))
            }
            datURL = accessibleURL
        } else {
            datURL = possibleDataURL
        }
    } else {
        datURL = url
        let possibleHdrURL = basePath.appendingPathExtension("hdr")
        
        // ‚úÖ –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è .hdr —Ñ–∞–π–ª–∞
        if !FileManager.default.isReadableFile(atPath: possibleHdrURL.path) {
            guard let accessibleURL = requestAccessToFile(possibleHdrURL, description: "–∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª") else {
                return .failure(.readError("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ .hdr —Ñ–∞–π–ª—É"))
            }
            hdrURL = accessibleURL
        } else {
            hdrURL = possibleHdrURL
        }
    }
    
    // ... –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
}
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### 1. **–ò—Å–ø–æ–ª—å–∑—É–µ–º `isReadableFile` –≤–º–µ—Å—Ç–æ `fileExists`**

```swift
// ‚ùå –ü–ª–æ—Ö–æ
FileManager.default.fileExists(atPath: url.path)
// –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å true, –Ω–æ —á—Ç–µ–Ω–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ —É–ø–∞–¥–µ—Ç –∏–∑-–∑–∞ sandbox

// ‚úÖ –•–æ—Ä–æ—à–æ
FileManager.default.isReadableFile(atPath: url.path)
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ, –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```

### 2. **–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ NSOpenPanel**

```swift
let panel = NSOpenPanel()
panel.message = "ENVI —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É"
panel.directoryURL = fileURL.deletingLastPathComponent()
panel.nameFieldStringValue = fileURL.lastPathComponent
```

**–í–∞–∂–Ω–æ:**
- `directoryURL` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- `nameFieldStringValue` ‚Äî –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π —Ñ–∞–π–ª
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, **–∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —Ñ–∞–π–ª** –Ω—É–∂–µ–Ω
- –û–¥–∏–Ω –∫–ª–∏–∫ –Ω–∞ "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø" ‚Äî –∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 3. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ**

```swift
DispatchQueue.main.sync {
    if panel.runModal() == .OK, let selectedURL = panel.url {
        return selectedURL
    }
    return nil
}
```

**–ü–æ—á–µ–º—É `sync`?**
- NSOpenPanel –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –Ω–∞ main thread
- –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º
- `load(from:)` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º sync

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–∫—Ä—ã–≤–∞–µ–º .hdr —Ñ–∞–π–ª

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ pre_katrina05.hdr

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
  ‚úÖ –î–æ—Å—Ç—É–ø –∫ .hdr –µ—Å—Ç—å
  ‚ùå –î–æ—Å—Ç—É–ø–∞ –∫ .dat –Ω–µ—Ç
  
  ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥:
    "ENVI —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É"
    üìÑ pre_katrina05.dat
    
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–ª–∏–∫ –Ω–∞ "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø"

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
  ‚úÖ –ü–æ–ª—É—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ .dat
  ‚úÖ –§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–∫—Ä—ã–≤–∞–µ–º .dat —Ñ–∞–π–ª

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ pre_katrina05.dat

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
  ‚úÖ –î–æ—Å—Ç—É–ø –∫ .dat –µ—Å—Ç—å
  ‚ùå –î–æ—Å—Ç—É–ø–∞ –∫ .hdr –Ω–µ—Ç
  
  ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥:
    "ENVI —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–Ω–æ–º—É —Ñ–∞–π–ª—É"
    üìÑ pre_katrina05.hdr
    
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–ª–∏–∫ –Ω–∞ "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø"

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
  ‚úÖ –ü–æ–ª—É—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ .hdr
  ‚úÖ –§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ File ‚Üí Open

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: Cmd+O ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç pre_katrina05.hdr

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
  ‚úÖ –î–æ—Å—Ç—É–ø –∫ .hdr –µ—Å—Ç—å
  ‚úÖ –î–æ—Å—Ç—É–ø –∫ .dat –µ—Å—Ç—å (–ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ NSOpenPanel)
  ‚úÖ –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–∫—Ä—ã—Ç–∏–µ .hdr –∏–∑ Finder:

```bash
# –í Finder:
–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ test_data/pre_katrina05.hdr

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –ü–æ—è–≤–∏—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å –∑–∞–ø—Ä–æ—Å–æ–º –¥–æ—Å—Ç—É–ø–∞ –∫ pre_katrina05.dat
2. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
3. ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞!
```

### 2. –û—Ç–∫—Ä—ã—Ç–∏–µ .dat –∏–∑ Finder:

```bash
# –í Finder:
–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ test_data/pre_katrina05.dat

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –ü–æ—è–≤–∏—Ç—Å—è –¥–∏–∞–ª–æ–≥ —Å –∑–∞–ø—Ä–æ—Å–æ–º –¥–æ—Å—Ç—É–ø–∞ –∫ pre_katrina05.hdr
2. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
3. ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞!
```

### 3. –û—Ç–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ File ‚Üí Open:

```bash
# –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
Cmd+O ‚Üí –≤—ã–±–∏—Ä–∞–µ–º –ª—é–±–æ–π .hdr –∏–ª–∏ .dat

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. –ü–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
2. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
3. ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!
```

## üîí –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)

### 1. **–û—Ç–∫–ª—é—á–∏—Ç—å sandbox**

```xml
<!-- –í .entitlements -->
<key>com.apple.security.app-sandbox</key>
<false/>
```

**‚ùå –ü–ª–æ—Ö–æ:**
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
- –ù–µ –ø—Ä–æ–π–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É Mac App Store
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –¥–æ–≤–µ—Ä—è—é—Ç —Ç–∞–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º

### 2. **–ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏**

```swift
let panel = NSOpenPanel()
panel.canChooseDirectories = true
panel.canChooseFiles = false
```

**‚ùå –ü–ª–æ—Ö–æ:**
- –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π –¥–æ—Å—Ç—É–ø
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∑–∞—á–µ–º –Ω—É–∂–Ω–∞ –≤—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ

### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å security-scoped bookmarks**

```swift
let bookmarkData = try url.bookmarkData(options: .withSecurityScope)
```

**‚ùå –ü–ª–æ—Ö–æ:**
- –°–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å bookmarks
- –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö entitlements
- –ò–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—à–µ–π –∑–∞–¥–∞—á–∏

### 4. **–ü—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±—Ä–∞—Ç—å –æ–±–∞ —Ñ–∞–π–ª–∞**

**‚ùå –ü–ª–æ—Ö–æ:**
- –ü–ª–æ—Ö–æ–π UX
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –Ω–µ —Ç–µ —Ñ–∞–π–ª—ã
- –ù–∞—Ä—É—à–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—Ç—å)

## ‚úÖ –ü–æ—á–µ–º—É –Ω–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –ª—É—á—à–µ?

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ñ–∞–π–ª—É
   - –ù–µ —Ç—Ä–µ–±—É–µ–º –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - –†–∞–±–æ—Ç–∞–µ—Ç –≤ sandbox

2. **UX:**
   - –û–¥–∏–Ω –¥–∏–∞–ª–æ–≥ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   - –§–∞–π–ª —É–∂–µ –≤—ã–±—Ä–∞–Ω –∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω
   - –û–¥–∏–Ω –∫–ª–∏–∫ "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø" ‚Äî –∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏

3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞:**
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥
   - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö entitlements
   - –ù–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å bookmarks
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π NSOpenPanel

4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è .hdr ‚Üí .dat
   - –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è .dat ‚Üí .hdr
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ ENVI —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ (img, bsq, bil, bip, raw)
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –¢—Ä–µ–±–æ–≤–∞–ª–æ—Å—å **2 –ø–æ–ø—ã—Ç–∫–∏** –æ—Ç–∫—Ä—ã—Ç—å ENVI —Ñ–∞–π–ª
- ‚ùå –ù–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ "—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
- ‚ùå –ü–ª–æ—Ö–æ–π UX

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ **1 –ø–æ–ø—ã—Ç–∫–∞** —Å –ø—Ä–æ—Å—Ç—ã–º –¥–∏–∞–ª–æ–≥–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –û—Ç–ª–∏—á–Ω—ã–π UX

## üìÖ –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

2025-11-28

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `HSIView/Services/EnviImageLoader.swift` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
- `HSIView/Models/EnviHeader.swift` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ .hdr
- `HSIView/Info.plist` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- `ENVI_format.md` ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞

