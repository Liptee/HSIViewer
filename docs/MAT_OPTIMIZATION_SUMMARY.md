# –†–µ–∑—é–º–µ: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –¥–ª—è MAT —Ñ–∞–π–ª–æ–≤

## ‚úÖ –ì–û–¢–û–í–û! uint8 —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∑–∞–Ω–∏–º–∞—é—Ç –≤ 8x –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏!

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
MAT —Ñ–∞–π–ª—ã —Å uint8 –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `double`, –∑–∞–Ω–∏–º–∞—è **8x –ø–∞–º—è—Ç–∏**.

**–ü—Ä–∏–º–µ—Ä (asphalt2.mat):**
```
–§–∞–π–ª: 518 –ú–ë (uint8)
–í –ø–∞–º—è—Ç–∏: 4 –ì–ë (double) ‚Üê 8x overhead!
```

**–†–µ—à–µ–Ω–∏–µ:**
–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ **–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–∞—Ö** (–∫–∞–∫ –¥–ª—è NPY –∏ TIFF).

## üìä –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏

| –¢–∏–ø | –§–∞–π–ª 100 –ú–ë: –î–æ | –§–∞–π–ª 100 –ú–ë: –ü–æ—Å–ª–µ | –≠–∫–æ–Ω–æ–º–∏—è |
|-----|-----------------|---------------------|----------|
| **uint8** | 800 –ú–ë | **100 –ú–ë** | **-700 –ú–ë (88%)** üéâ |
| **uint16** | 800 –ú–ë | **200 –ú–ë** | **-600 –ú–ë (75%)** üéâ |
| **int16** | 800 –ú–ë | **200 –ú–ë** | **-600 –ú–ë (75%)** üéâ |
| **float32** | 800 –ú–ë | **400 –ú–ë** | **-400 –ú–ë (50%)** üéâ |
| **float64** | 800 –ú–ë | 800 –ú–ë | 0 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) |

### asphalt2.mat:
```
–î–û:    4147 –ú–ë (~4 –ì–ë) 
–ü–û–°–õ–ï:  518 –ú–ë
–≠–ö–û–ù–û–ú–ò–Ø: 3629 –ú–ë (88%)! üéâ
```

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### 1. MatHelper.h - –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```c
// –ë—ã–ª–æ
typedef struct {
    double *data;  // –í—Å–µ–≥–¥–∞ double
    size_t dims[3];
    int rank;
} MatCube3D;

// –°—Ç–∞–ª–æ
typedef struct {
    void *data;              // ‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–∏–ø!
    size_t dims[3];
    int rank;
    MatDataType data_type;   // ‚Üê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ
} MatCube3D;
```

### 2. MatHelper.c - –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:
```c
// –ë—ã–ª–æ: uint8 ‚Üí double
double *buf = malloc(total * sizeof(double));  // 8 –±–∞–π—Ç
for (i = 0; i < total; ++i) {
    buf[i] = (double)src[i];  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è!
}

// –°—Ç–∞–ª–æ: uint8 ‚Üí uint8
void *buf = malloc(total * sizeof(uint8_t));  // 1 –±–∞–π—Ç
memcpy(buf, full->data, total * sizeof(uint8_t));  // –ë–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏!
outCube->data_type = MAT_DATA_UINT8;
```

### 3. MatImageLoader.swift - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π DataStorage:
```swift
// –ë—ã–ª–æ
let storage: DataStorage = .float64(arr)  // –í—Å–µ–≥–¥–∞ float64

// –°—Ç–∞–ª–æ
switch cCube.data_type {
case MAT_DATA_UINT8:
    storage = .uint8(Array(buffer))  // ‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–∏–ø!
case MAT_DATA_FLOAT64:
    storage = .float64(Array(buffer))
// ...
}
```

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥:
```swift
let value = cube.getValue(at: lin)  // ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Double
```
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è uint8 ‚Üí Double –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ**, –∞ –Ω–µ –¥–ª—è –≤—Å–µ–≥–æ –∫—É–±–∞!

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:
```swift
let normalized = DataNormalizer.normalize(slice)  // 0-1
let pixels = DataNormalizer.toUInt8(normalized.normalized)  // 0-255
```
–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

### 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å:
```swift
cube.storage.sizeInBytes  // ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä!
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏.

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
cd /Users/mac/Desktop/HSIView
open HSIView.xcodeproj
# Cmd+R
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ asphalt2.mat:

**–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –§–∞–π–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
  - –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: **UInt8** (–≤–º–µ—Å—Ç–æ Float64)
  - –†–∞–∑–º–µ—Ä –≤ –ø–∞–º—è—Ç–∏: **~518 –ú–ë** (–≤–º–µ—Å—Ç–æ 4 –ì–ë)
  - –î–∏–∞–ø–∞–∑–æ–Ω: 0-255

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Activity Monitor:

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```
HSIView: 4.5 –ì–ë –ø–∞–º—è—Ç–∏
```

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```
HSIView: 600-700 –ú–ë –ø–∞–º—è—Ç–∏
–≠–ö–û–ù–û–ú–ò–Ø: ~3.8 –ì–ë! üéâ
```

## üìö –í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

| –§–æ—Ä–º–∞—Ç | –¢–∏–ø—ã | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è |
|--------|------|-------------|
| **MAT** | float64, float32, uint8, uint16, int8, int16 | ‚úÖ –í–°–ï |
| **NPY** | float64, float32, uint8, uint16, int8, int16, int32 | ‚úÖ –í–°–ï |
| **TIFF** | uint8 | ‚úÖ |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:

| –§–∞–π–ª | –¢–∏–ø | –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –ë—ã–ª–æ –≤ –ø–∞–º—è—Ç–∏ | –°—Ç–∞–ª–æ –≤ –ø–∞–º—è—Ç–∏ | –≠–∫–æ–Ω–æ–º–∏—è |
|------|-----|--------------|---------------|----------------|----------|
| asphalt2.mat | uint8 | 518 –ú–ë | 4.1 –ì–ë | 518 –ú–ë | 88% üéâ |
| –º–æ–Ω–∏–ª–∏–æ–∑_1.npy | uint8 | 2.4 –ì–ë | 19.2 –ì–ë | 2.4 –ì–ë | 88% üéâ |
| Tablet.tiff | uint8 | 320 –ú–ë | 2.5 –ì–ë | 320 –ú–ë | 88% üéâ |

**–ò—Ç–æ–≥–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏—è –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ñ–∞–π–ª–æ–≤: ~20 –ì–ë!** üöÄ

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **`MAT_OPTIMIZATION_SUMMARY.md`** ‚≠ê - —ç—Ç–æ —Ä–µ–∑—é–º–µ
- **`MAT_MEMORY_OPTIMIZATION.md`** ‚≠ê - –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`CHANGELOG.md`** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéâ –ò–¢–û–ì–û

### –ë—ã–ª–æ:
- ‚ùå MAT uint8 —Ñ–∞–π–ª—ã –∑–∞–Ω–∏–º–∞–ª–∏ 8x –ø–∞–º—è—Ç–∏
- ‚ùå asphalt2.mat 518 –ú–ë ‚Üí 4 –ì–ë –≤ –ø–∞–º—è—Ç–∏
- ‚ùå –õ–∏—à–Ω—è—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

### –°—Ç–∞–ª–æ:
- ‚úÖ MAT uint8 —Ñ–∞–π–ª—ã –∑–∞–Ω–∏–º–∞—é—Ç 1x –ø–∞–º—è—Ç–∏
- ‚úÖ asphalt2.mat 518 –ú–ë ‚Üí 518 –ú–ë –≤ –ø–∞–º—è—Ç–∏
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 88% –ø–∞–º—è—Ç–∏!

---

**–ì–û–¢–û–í–û! –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ!** üöÄ

**–ö–æ–º–º–∏—Ç:** `9976f70`  
**–î–∞—Ç–∞:** 2025-11-28


