# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ TIFF —Ñ–∞–π–ª–æ–≤

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

TIFF —Ñ–∞–π–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª–æ—Å–∞–º–∏ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞:**
- Width: 1536
- Height: 1526
- Samples/Pixel: 160 (–∫–∞–Ω–∞–ª–æ–≤)
- Planar Configuration: separate
- Bits/Sample: 8

**–û—à–∏–±–∫–∞:** –î–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, dims –±—ã–ª–∏ –≤ –Ω–µ–≤–µ—Ä–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ dims –≤ TiffHelper.c

**–ë—ã–ª–æ:**
```c
outCube->dims[0] = C;  // 160
outCube->dims[1] = H;  // 1526
outCube->dims[2] = W;  // 1536
// CHW layout
```

**–°—Ç–∞–ª–æ:**
```c
outCube->dims[0] = H;  // 1526
outCube->dims[1] = W;  // 1536
outCube->dims[2] = C;  // 160
// HWC layout (—Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è column-major

**–ë—ã–ª–æ:**
```c
// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
dstIdx = col * H + row;
data[base + dstIdx] = temp[srcIdx];
```

**–°—Ç–∞–ª–æ:**
```c
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–ª—è column-major (H, W, C)
// –ò–Ω–¥–µ–∫—Å = row + H * (col + W * channel)
size_t row = written / W;
size_t col = written % W;
size_t colMajorIdx = row + H * (col + W * (size_t)s);
data[colMajorIdx] = (double)buf[i] / 255.0;
```

### 3. –ò–∑–º–µ–Ω–µ–Ω default layout –¥–ª—è TIFF –≤ AppState

**–ë—ã–ª–æ:**
```swift
layout = .chw  // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è TIFF
```

**–°—Ç–∞–ª–æ:**
```swift
layout = .hwc  // –ü—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

## üìê –ü–æ—á–µ–º—É HWC –¥–ª—è TIFF?

TIFF - —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç **–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**, –∞ –Ω–µ –Ω–∞—É—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: Height √ó Width √ó Channels
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç PIL, OpenCV, –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É image libraries
- Natural –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –≤–∏–¥–µ–æ

MATLAB .mat - —ç—Ç–æ –Ω–∞—É—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –ü–æ—Ä—è–¥–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º
- Auto layout –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ß–∞—Å—Ç–æ CHW (Channels first) –∏–∑ PyTorch

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

–î–ª—è TIFF —Å (H=1526, W=1536, C=160):

**Row-major (–∫–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ TIFF strips):**
```
–ö–∞–Ω–∞–ª 0: pixel[0,0], pixel[0,1], ..., pixel[0,1535], pixel[1,0], ..., pixel[1525,1535]
–ö–∞–Ω–∞–ª 1: pixel[0,0], pixel[0,1], ...
```

**Column-major HWC (–∫–∞–∫ –Ω—É–∂–Ω–æ –¥–ª—è MATLAB):**
```
–ò–Ω–¥–µ–∫—Å –¥–ª—è pixel[row, col, channel]:
idx = row + H * (col + W * channel)

–ü—Ä–∏–º–µ—Ä:
pixel[0,0,0] ‚Üí idx = 0 + 1526 * (0 + 1536 * 0) = 0
pixel[1,0,0] ‚Üí idx = 1 + 1526 * (0 + 1536 * 0) = 1
pixel[0,1,0] ‚Üí idx = 0 + 1526 * (1 + 1536 * 0) = 1526
pixel[0,0,1] ‚Üí idx = 0 + 1526 * (0 + 1536 * 1) = 2,343,936
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ:**
   ```bash
   open HSIView.xcodeproj
   # Product ‚Üí Clean Build Folder (‚áß‚åòK)
   # Product ‚Üí Build (‚åòB)
   # Product ‚Üí Run (‚åòR)
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ TIFF —Ñ–∞–π–ª**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - Layout –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **HWC** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 1526 √ó 1536 √ó 160
   - –ö–∞–Ω–∞–ª—ã: 160
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–±–µ–∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª–æ—Å)

## üìä –ü–æ–Ω–∏–º–∞–Ω–∏–µ column-major –¥–ª—è HWC

```
–î–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ (column-major):
[0,0,0], [1,0,0], [2,0,0], ..., [H-1,0,0],  // –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü, –∫–∞–Ω–∞–ª 0
[0,1,0], [1,1,0], [2,1,0], ..., [H-1,1,0],  // –≤—Ç–æ—Ä–æ–π —Å—Ç–æ–ª–±–µ—Ü, –∫–∞–Ω–∞–ª 0
...
[0,W-1,0], ..., [H-1,W-1,0],                // –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–æ–ª–±–µ—Ü, –∫–∞–Ω–∞–ª 0
[0,0,1], [1,0,1], ..., [H-1,W-1,1],         // –≤—Å–µ –ø–∏–∫—Å–µ–ª–∏ –∫–∞–Ω–∞–ª–∞ 1
...
```

–§–æ—Ä–º—É–ª–∞: `idx = row + H * (col + W * channel)`

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ –µ—â–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å:**
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "1526 √ó 1536 √ó 160"
   - Layout: HWC
   - –ö–∞–Ω–∞–ª—ã: 160

2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ layout'—ã:**
   - Auto
   - CHW
   - HWC ‚Üê –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

3. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Å Python:**
   ```bash
   python3 -c "
   import tifffile
   import matplotlib.pyplot as plt
   
   data = tifffile.imread('your_file.tiff')
   print(f'Shape: {data.shape}')
   
   # –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª
   plt.imshow(data[0] if data.shape[0] < 200 else data[:,:,0], cmap='gray')
   plt.show()
   "
   ```

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `HSIView/TiffHelper.c`:
  - dims —Ç–µ–ø–µ—Ä—å (H, W, C) –≤–º–µ—Å—Ç–æ (C, H, W)
  - –£–±—Ä–∞–Ω –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –±—É—Ñ–µ—Ä temp
  - –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ column-major –ø–æ—Ä—è–¥–æ–∫
  
- `HSIView/AppState.swift`:
  - TIFF layout: CHW ‚Üí HWC

---

**TIFF —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** ‚úÖ

