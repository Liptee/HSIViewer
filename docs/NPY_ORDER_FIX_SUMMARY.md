# –†–µ–∑—é–º–µ: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ C/Fortran order

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** NPY —Ñ–∞–π–ª—ã –∫–∞–∫ –≤ C-order, —Ç–∞–∫ –∏ –≤ Fortran-order, **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ–ø—Ä–µ–¥–µ–ª—è—è —Ç–∏–ø –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

## üîç –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏

–ú–æ–µ –ø–µ—Ä–≤–æ–µ "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" –ø—ã—Ç–∞–ª–æ—Å—å **–ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å** –¥–∞–Ω–Ω—ã–µ –∏–∑ Fortran –≤ C. –≠—Ç–æ –±—ã–ª–æ **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û** –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚ùå NumPy **–Ω–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç** –¥–∞–Ω–Ω—ã–µ
2. ‚ùå –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **strides** –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
3. ‚ùå –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —É–¥–≤–∞–∏–≤–∞–ª–æ –ø–∞–º—è—Ç—å (~40 –ì–ë –¥–ª—è 2 –ì–ë —Ñ–∞–π–ª–∞)
4. ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–°–ï NPY —Ñ–∞–π–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ø–æ–ª–æ—Å—ã! üò±

## ‚ú® –ù–æ–≤–æ–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ) —Ä–µ—à–µ–Ω–∏–µ

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç NumPy

NumPy **–Ω–µ –º–µ–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏**. –û–Ω –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**:

**C-order (row-major):**
```
–ü–æ—Ä—è–¥–æ–∫ –≤ –ø–∞–º—è—Ç–∏: [0,0,0], [0,0,1], [0,0,2], ..., [0,0,C-1], [0,1,0], ...
–ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–Ω–¥–µ–∫—Å –º–µ–Ω—è–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
–§–æ—Ä–º—É–ª–∞: i2 + d2 * (i1 + d1 * i0)
```

**Fortran-order (column-major):**
```
–ü–æ—Ä—è–¥–æ–∫ –≤ –ø–∞–º—è—Ç–∏: [0,0,0], [1,0,0], [2,0,0], ..., [H-1,0,0], [0,1,0], ...
–ü–µ—Ä–≤—ã–π –∏–Ω–¥–µ–∫—Å –º–µ–Ω—è–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
–§–æ—Ä–º—É–ª–∞: i0 + d0 * (i1 + d1 * i2)
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

#### 1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ –≤ HyperCube:

```swift
struct HyperCube {
    let dims: (Int, Int, Int)
    let data: [Double]
    let originalDataType: DataType
    let sourceFormat: String
    let isFortranOrder: Bool  // ‚Üê –ù–û–í–û–ï!
}
```

#### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:

```swift
func linearIndex(i0: Int, i1: Int, i2: Int) -> Int {
    if isFortranOrder {
        return i0 + d0 * (i1 + d1 * i2)  // Fortran
    } else {
        return i2 + d2 * (i1 + d1 * i0)  // C
    }
}
```

#### 3. NPY loader —á–∏—Ç–∞–µ—Ç —Ñ–ª–∞–≥ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞:

```swift
isFortranOrder: header.fortranOrder  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

#### 4. –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è:

```swift
// ‚ùå –£–î–ê–õ–ï–ù–û:
// private static func reorderFromFortranToC(...) { ... }
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä–æ–µ (–ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ) | –ù–æ–≤–æ–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è) |
|--------|----------------------------|-------------------------------|
| **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å** | ‚ùå –í—Å–µ —Ñ–∞–π–ª—ã —Å –ø–æ–ª–æ—Å–∞–º–∏ | ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ |
| **–ü–∞–º—è—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ** | ~40 –ì–ë (2x) | **~20 –ì–ë (1x)** ‚ú® |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏** | –ú–µ–¥–ª–µ–Ω–Ω–æ | **–ë—ã—Å—Ç—Ä–æ** ‚ú® |
| **–ü–æ–¥—Ö–æ–¥** | –ù–µ –∫–∞–∫ NumPy | **–ö–∞–∫ NumPy** ‚úÖ |

**–≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏: ~20 –ì–ë –¥–ª—è —Ñ–∞–π–ª–∞ 2.4 –ì–ë uint8!**

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

```bash
cd /Users/mac/Desktop/HSIView
python3 test_both_orders.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- `test_gradient_c_order.npy` (C-order)
- `test_gradient_f_order.npy` (Fortran-order)

### 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
open HSIView.xcodeproj
# –ù–∞–∂–º–∏—Ç–µ Cmd+R
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –æ–±–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –û–ë–ê —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –û–î–ò–ù–ê–ö–û–í–û!**

- –ö–∞–Ω–∞–ª 0: –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç (—Ç–µ–º–Ω—ã–π —Å–≤–µ—Ä—Ö—É ‚Üí —Å–≤–µ—Ç–ª—ã–π —Å–Ω–∏–∑—É)
- –ö–∞–Ω–∞–ª 1: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç (—Ç–µ–º–Ω—ã–π —Å–ª–µ–≤–∞ ‚Üí —Å–≤–µ—Ç–ª—ã–π —Å–ø—Ä–∞–≤–∞)
- –ö–∞–Ω–∞–ª 2: –î–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç

**–ï—Å–ª–∏ –≤–∏–¥–Ω—ã –ø–æ–ª–æ—Å—ã –∏–ª–∏ —Ñ–∞–π–ª—ã –≤—ã–≥–ª—è–¥—è—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É - –µ—Å—Ç—å –æ—à–∏–±–∫–∞!**

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª

–û—Ç–∫—Ä–æ–π—Ç–µ `–º–æ–Ω–∏–ª–∏–æ–∑_1.npy` - –æ–Ω –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è **–±–µ–∑ –ø–æ–ª–æ—Å**! ‚úÖ

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª—é–±–æ–π NPY —Ñ–∞–π–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
python3 inspect_real_npy.py <your_file.npy>
```

–ü–æ–∫–∞–∂–µ—Ç:
- Shape, dtype
- C_CONTIGUOUS –∏–ª–∏ F_CONTIGUOUS
- –ö–∞–∫–æ–π order –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω
- –ü–µ—Ä–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø–∞–º—è—Ç–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **`NPY_ORDER_FIX_V2.md`** ‚≠ê - –ø–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
- **`test_both_orders.py`** - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **`test_npy_orders.py`** - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç NumPy
- **`inspect_real_npy.py`** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üéØ –ò—Ç–æ–≥

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —Å –ø–æ–ª–æ—Å–∞–º–∏ (–ø—Ä–æ–±–ª–µ–º–∞ —Å order)

### –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ):
- ‚ùå –í–°–ï —Ñ–∞–π–ª—ã —Å –ø–æ–ª–æ—Å–∞–º–∏
- ‚ùå –£–¥–≤–æ–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### –ü–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ):
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è ~20 –ì–ë –ø–∞–º—è—Ç–∏ (–Ω–µ—Ç –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è)
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –ü–æ–¥—Ö–æ–¥ –∫–∞–∫ –≤ NumPy

---

**–î–∞—Ç–∞:** 2025-11-28

**–ö–æ–º–º–∏—Ç:** `f49973c - fix: correct NPY order handling - use proper indexing like NumPy`

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ! –í—Å–µ NPY —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å! üöÄ

