# ENVI: –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ ENVI —Ñ–æ—Ä–º–∞—Ç–∞ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è **—Ç—Ä–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**:

1. ‚ùå –ü–∞—Ä–Ω—ã–π —Ñ–∞–π–ª (.dat/.hdr) –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª—Å—è
2. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ BIL/BIP ‚Üí (C,H,W) –≤–º–µ—Å—Ç–æ (H,W,C)
3. ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ—Ä—è–¥–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–ª–∞–≥–æ–º `isFortranOrder`

**–í—Å–µ —Ç—Ä–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!** ‚úÖ

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª—Å—è

### –û—à–∏–±–∫–∞:
```swift
// –°–¢–ê–†–´–ô –ö–û–î:
if fileExt == "hdr" {
    datURL = url.deletingPathExtension()  // ‚ùå "/path/to/cube" (–±–µ–∑ .dat!)
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```swift
private static func findDataFile(basePath: URL) -> URL? {
    let possibleExtensions = ["dat", "img", "bsq", "bil", "bip", "raw"]
    for ext in possibleExtensions {
        let url = basePath.appendingPathExtension(ext)
        if FileManager.default.fileExists(atPath: url.path) {
            return url  // ‚úÖ –ù–∞—à–ª–∏!
        }
    }
    return nil
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ENVI –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤!

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ

### –û—à–∏–±–∫–∞:
–ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ (C, H, W) –≤–º–µ—Å—Ç–æ (H, W, C):

```swift
// –°–¢–ê–†–´–ô –ö–û–î:
for c in 0..<C {  // ‚ùå –°–æ–∑–¥–∞–µ—Ç (C, H, W) Fortran order
    for h in 0..<H {
        for w in 0..<W {
            result.append(...)
        }
    }
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
–ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ —Ü–∏–∫–ª–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (H, W, C) C-order:

```swift
// –ù–û–í–´–ô –ö–û–î:
for h in 0..<H {  // ‚úÖ –°–æ–∑–¥–∞–µ—Ç (H, W, C) C-order
    for w in 0..<W {
        for c in 0..<C {
            result.append(...)
        }
    }
}
```

**BSQ:** (C,H,W) ‚Üí (H,W,C) ‚úÖ  
**BIL:** (H,C,W) ‚Üí (H,W,C) ‚úÖ  
**BIP:** (H,W,C) ‚Üí —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚úÖ

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `isFortranOrder`

### –û—à–∏–±–∫–∞:
```swift
dims = (H, W, C)
isFortranOrder = true  // ‚ùå –û–∂–∏–¥–∞–µ—Ç Fortran order
// –ù–æ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –≤ C-order!
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```swift
dims = (H, W, C)
isFortranOrder = false  // ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç C-order –¥–∞–Ω–Ω—ã—Ö
```

–§–æ—Ä–º—É–ª–∞ `linearIndex` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è:
```
idx = c + C * (w + W * h)
```

---

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –í—Å–µ —Ç–∏–ø—ã interleave:
- ‚úÖ **BSQ** (Band Sequential)
- ‚úÖ **BIL** (Band Interleaved by Line)
- ‚úÖ **BIP** (Band Interleaved by Pixel)

### 2. –í—Å–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
- ‚úÖ `.dat` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
- ‚úÖ `.img` (image)
- ‚úÖ `.bsq` (BSQ —Ñ–æ—Ä–º–∞—Ç)
- ‚úÖ `.bil` (BIL —Ñ–æ—Ä–º–∞—Ç)
- ‚úÖ `.bip` (BIP —Ñ–æ—Ä–º–∞—Ç)
- ‚úÖ `.raw` (raw data)

### 3. –í—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ `uint8`, `int8`, `int16`, `int32`
- ‚úÖ `uint16`, `uint32`
- ‚úÖ `float32`, `float64`

### 4. Byte order:
- ‚úÖ Little endian (0)
- ‚úÖ Big endian (1)

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –ü–æ–∏—Å–∫ –ø–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (.dat ‚Üî .hdr)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ wavelengths –∏–∑ .hdr
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ layout (.hwc)
- ‚úÖ –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–∑ Finder

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω—ã Python —Å–∫—Ä–∏–ø—Ç—ã:

1. **`python_tests/check_envi.py`**
   - –ê–Ω–∞–ª–∏–∑ .hdr —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤

2. **`python_tests/read_envi_test.py`**
   - –ß—Ç–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö ENVI —Ñ–∞–π–ª–æ–≤
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

3. **`python_tests/verify_envi_order.py`**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è
   - –¢–µ—Å—Ç—ã –¥–ª—è BSQ, BIL, BIP

4. **`python_tests/test_fortran_order.py`**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—É–ª `linearIndex`
   - Fortran vs C order

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

‚úÖ **pre_katrina05.dat**
- –†–∞–∑–º–µ—Ä: 5270 √ó 5720 √ó 1 (2D –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
- –§–æ—Ä–º–∞—Ç: BSQ
- –¢–∏–ø: uint8
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

‚úÖ **AV320240720t181127_000_L2A_OE_f01ef58f_RFL_ORT.dat**
- –†–∞–∑–º–µ—Ä: 1341 √ó 1381 √ó 284
- –§–æ—Ä–º–∞—Ç: BIL
- –¢–∏–ø: float32
- Wavelengths: 284 –∑–Ω–∞—á–µ–Ω–∏—è (389.8 - 2493.5 –Ω–º)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, wavelengths –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- üìñ **ENVI_SUPPORT.md** - –û–±—â–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è ENVI
- üìñ **ENVI_PAIR_FIX.md** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- üìñ **ENVI_ORDER_FIX.md** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- üìñ **ENVI_COMPLETE_FIX_SUMMARY.md** - –≠—Ç–∞ —Å–≤–æ–¥–∫–∞
- üìñ **CHANGELOG.md** - –û–±–Ω–æ–≤–ª–µ–Ω

---

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
cd /Users/mac/Desktop/HSIView
open HSIView.xcodeproj
# Cmd+R
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ ENVI —Ñ–∞–π–ª—ã:

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –º–µ–Ω—é**
```
Cmd+O ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ .hdr –∏–ª–∏ .dat —Ñ–∞–π–ª
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò–∑ Finder**
```
–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ –ª—é–±–æ–π —Ñ–∞–π–ª (.hdr, .dat, .img, –∏ —Ç.–¥.)
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- ‚úÖ –§–∞–π–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –†–∞–∑–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ (—Å–º. info –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞)
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ –ø–æ–ª–æ—Å/–∏—Å–∫–∞–∂–µ–Ω–∏–π
- ‚úÖ Wavelengths –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ .hdr)
- ‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
- ‚úÖ RGB synthesis —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å wavelengths)

---

## üìä –ö–æ–º–º–∏—Ç—ã

```
dd23c48 fix: correct ENVI data ordering (C-order for HWC dims)
3e4ccc9 docs: update CHANGELOG for ENVI fixes
b12a222 fix: ENVI paired file search (.hdr ‚Üî binary)
b0e416c fix: correct ENVI format implementation
89dde92 feat: add ENVI format support (.dat + .hdr)
```

---

## üéØ –ò—Ç–æ–≥

**ENVI —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!**

–í—Å–µ —Ç—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:
1. ‚úÖ –ü–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
2. ‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. ‚úÖ –ü–æ—Ä—è–¥–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `isFortranOrder`

**–ì–∏–ø–µ—Ä—Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω—ã–µ ENVI —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!** üéâ

---

## –î–∞—Ç–∞

2025-11-28

**–í–µ—Ä—Å–∏—è:** v4 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

